import{Q as e,w as t,G as o,cW as i,k as n,e as a,cX as r,X as s,ad as l,r as p,cY as u,a as c,bu as h,aa as d,ab as f,d as g,c5 as m,aA as v,cZ as y,_,bq as S,$ as M,s as b,C as w,x,aU as T,N as V,b as C,S as D,m as I,bL as L,a3 as R,c_ as z,bK as O,af as G,c$ as A,as as H,aD as N,b5 as P,aH as E,bo as k,aj as B,h as F,f as Y,aJ as X,d0 as Z,M as W,a$ as j,d1 as J,a_ as K,u as U,cR as q,b4 as $,y as Q,a2 as ee,z as te,aX as oe,A as ie,d2 as ne,d3 as ae,av as re,ah as se,ai as le,p as pe,bz as ue,aB as ce,aC as he,d4 as de,d5 as fe,d6 as ge,ch as me,R as ve,J as ye,ae as _e,aY as Se,b6 as Me,bs as be,d7 as we,ag as xe,U as Te,Y as Ve,cL as Ce,cc as De,a8 as Ie,Z as Le,b9 as Re,b3 as ze,cJ as Oe,d8 as Ge,cK as Ae,ck as He,d9 as Ne,da as Pe}from"./install.f743767a.js";import{R as Ee}from"./RoamController.258ec694.js";import{o as ke}from"./cursorHelper.990d559a.js";import{c as Be}from"./createListSimply.02618497.js";import{a as Fe,S as Ye,p as Xe}from"./points.8d402e68.js";import{c as Ze}from"./labelHelper.1919236e.js";import{s as We}from"./sliderMove.9fa02ce2.js";function je(e,t,o){var i=e.target;i.x+=t,i.y+=o,i.dirty()}function Je(e,t,o,i){var n=e.target,a=e.zoomLimit,r=e.zoom=e.zoom||1;if(r*=t,a){var s=a.min||0,l=a.max||1/0;r=Math.max(Math.min(l,r),s)}var p=r/e.zoom;e.zoom=r,n.x-=(o-n.x)*(p-1),n.y-=(i-n.y)*(p-1),n.scaleX*=p,n.scaleY*=p,n.dirty()}var Ke=["rect","circle","line","ellipse","polygon","polyline","path"],Ue=e(Ke),qe=e(Ke.concat(["g"])),$e=e(Ke.concat(["g"])),Qe=t();function et(e){var t=e.getItemStyle(),o=e.get("areaColor");return null!=o&&(t.fill=o),t}var tt=function(){function t(e){var t=new o;this.uid=i("ec_map_draw"),this._controller=new Ee(e.getZr()),this._controllerHost={target:t},this.group=t,t.add(this._regionsGroup=new o),t.add(this._svgGroup=new o)}return t.prototype.draw=function(e,t,o,i,a){var r="geo"===e.mainType,s=e.getData&&e.getData();r&&t.eachComponent({mainType:"series",subType:"map"},(function(t){s||t.getHostGeoModel()!==e||(s=t.getData())}));var l=e.coordinateSystem,p=this._regionsGroup,u=this.group,c=l.getTransformInfo(),h=c.raw,d=c.roam;!p.childAt(0)||a?(u.x=d.x,u.y=d.y,u.scaleX=d.scaleX,u.scaleY=d.scaleY,u.dirty()):n(u,d,e);var f=s&&s.getVisual("visualMeta")&&s.getVisual("visualMeta").length>0,g={api:o,geo:l,mapOrGeoModel:e,data:s,isVisualEncodedByVisualMap:f,isGeo:r,transformInfoRaw:h};"geoJSON"===l.resourceType?this._buildGeoJSON(g):"geoSVG"===l.resourceType&&this._buildSVG(g),this._updateController(e,t,o),this._updateMapSelectHandler(e,p,o,i)},t.prototype._buildGeoJSON=function(t){var i=this._regionsGroupByName=e(),n=e(),p=this._regionsGroup,u=t.transformInfoRaw,c=t.mapOrGeoModel,h=t.data,d=function(e){return[e[0]*u.scaleX+u.x,e[1]*u.scaleY+u.y]};p.removeAll(),a(t.geo.regions,(function(e){var u=e.name,f=i.get(u),g=n.get(u)||{},m=g.dataIdx,v=g.regionModel;f||(f=i.set(u,new o),p.add(f),m=h?h.indexOfName(u):null,v=t.isGeo?c.getRegionModel(u):h?h.getItemModel(m):null,n.set(u,{dataIdx:m,regionModel:v}));var y=new r({segmentIgnoreThreshold:1,shape:{paths:[]}});f.add(y),a(e.geometries,(function(e){if("polygon"===e.type){for(var t=[],o=0;o<e.exterior.length;++o)t.push(d(e.exterior[o]));y.shape.paths.push(new s({segmentIgnoreThreshold:1,shape:{points:t}}));for(o=0;o<(e.interiors?e.interiors.length:0);++o){for(var i=e.interiors[o],n=[],a=0;a<i.length;++a)n.push(d(i[a]));y.shape.paths.push(new s({segmentIgnoreThreshold:1,shape:{points:n}}))}}})),ot(t,y,m,v),y instanceof l&&(y.culling=!0);var _=d(e.getCenter());it(t,y,u,v,c,m,_)})),i.each((function(e,o){var i=n.get(o),a=i.dataIdx,r=i.regionModel;nt(t,e,o,r,c,a),at(t,e,o,r,c),rt(t,e,o,r,c)}),this)},t.prototype._buildSVG=function(t){var o=t.geo.map,i=t.transformInfoRaw;this._svgGroup.x=i.x,this._svgGroup.y=i.y,this._svgGroup.scaleX=i.scaleX,this._svgGroup.scaleY=i.scaleY,this._svgResourceChanged(o)&&(this._freeSVG(),this._useSVG(o));var n=this._svgDispatcherMap=e(),r=!1;a(this._svgGraphicRecord.named,(function(e){var o=e.name,i=t.mapOrGeoModel,a=t.data,s=e.svgNodeTagLower,p=e.el,u=a?a.indexOfName(o):null,c=i.getRegionModel(o);(null!=Ue.get(s)&&p instanceof l&&ot(t,p,u,c),p instanceof l&&(p.culling=!0),p.z2EmphasisLift=0,e.namedFrom)||(null!=$e.get(s)&&it(t,p,o,c,i,u,null),nt(t,p,o,c,i,u),at(t,p,o,c,i),null!=qe.get(s)&&("self"===rt(t,p,o,c,i)&&(r=!0),(n.get(o)||n.set(o,[])).push(p)))}),this),this._enableBlurEntireSVG(r,t)},t.prototype._enableBlurEntireSVG=function(e,t){if(e&&t.isGeo){var o=t.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle().opacity;this._svgGraphicRecord.root.traverse((function(e){if(!e.isGroup){p(e);var t=e.ensureState("blur").style||{};null==t.opacity&&null!=o&&(t.opacity=o),e.ensureState("emphasis")}}))}},t.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},t.prototype.findHighDownDispatchers=function(e,t){if(null==e)return[];var o=t.coordinateSystem;if("geoJSON"===o.resourceType){var i=this._regionsGroupByName;if(i){var n=i.get(e);return n?[n]:[]}}else if("geoSVG"===o.resourceType)return this._svgDispatcherMap&&this._svgDispatcherMap.get(e)||[]},t.prototype._svgResourceChanged=function(e){return this._svgMapName!==e},t.prototype._useSVG=function(e){var t=u.getGeoResource(e);if(t&&"geoSVG"===t.type){var o=t.useGraphic(this.uid);this._svgGroup.add(o.root),this._svgGraphicRecord=o,this._svgMapName=e}},t.prototype._freeSVG=function(){var e=this._svgMapName;if(null!=e){var t=u.getGeoResource(e);t&&"geoSVG"===t.type&&t.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},t.prototype._updateController=function(e,t,o){var i=e.coordinateSystem,n=this._controller,a=this._controllerHost;a.zoomLimit=e.get("scaleLimit"),a.zoom=i.getZoom(),n.enable(e.get("roam")||!1);var r=e.mainType;function s(){var t={type:"geoRoam",componentType:r};return t[r+"Id"]=e.id,t}n.off("pan").on("pan",(function(e){this._mouseDownFlag=!1,je(a,e.dx,e.dy),o.dispatchAction(c(s(),{dx:e.dx,dy:e.dy}))}),this),n.off("zoom").on("zoom",(function(e){this._mouseDownFlag=!1,Je(a,e.scale,e.originX,e.originY),o.dispatchAction(c(s(),{zoom:e.scale,originX:e.originX,originY:e.originY}))}),this),n.setPointerChecker((function(t,n,a){return i.containPoint([n,a])&&!ke(t,o,e)}))},t.prototype.resetForLabelLayout=function(){this.group.traverse((function(e){var t=e.getTextContent();t&&(t.ignore=Qe(t).ignore)}))},t.prototype._updateMapSelectHandler=function(e,t,o,i){var n=this;t.off("mousedown"),t.off("click"),e.get("selectedMode")&&(t.on("mousedown",(function(){n._mouseDownFlag=!0})),t.on("click",(function(e){n._mouseDownFlag&&(n._mouseDownFlag=!1)})))},t}();function ot(e,t,o,i){var n=i.getModel("itemStyle"),a=i.getModel(["emphasis","itemStyle"]),r=i.getModel(["blur","itemStyle"]),s=i.getModel(["select","itemStyle"]),l=et(n),u=et(a),c=et(s),d=et(r),f=e.data;if(f){var g=f.getItemVisual(o,"style"),m=f.getItemVisual(o,"decal");e.isVisualEncodedByVisualMap&&g.fill&&(l.fill=g.fill),m&&(l.decal=h(m,e.api))}t.setStyle(l),t.style.strokeNoScale=!0,t.ensureState("emphasis").style=u,t.ensureState("select").style=c,t.ensureState("blur").style=d,p(t)}function it(e,t,o,i,n,a,r){var s=e.data,l=e.isGeo,p=s&&isNaN(s.get(s.mapDimension("value"),a)),u=s&&s.getItemLayout(a);if(l||p||u&&u.showLabel){var c=l?o:a,h=void 0;(!s||a>=0)&&(h=n);var g=r?{normal:{align:"center",verticalAlign:"middle"}}:null;d(t,f(i),{labelFetcher:h,labelDataIndex:c,defaultText:o},g);var m=t.getTextContent();if(m&&(Qe(m).ignore=m.ignore,t.textConfig&&r)){var v=t.getBoundingRect().clone();t.textConfig.layoutRect=v,t.textConfig.position=[(r[0]-v.x)/v.width*100+"%",(r[1]-v.y)/v.height*100+"%"]}t.disableLabelAnimation=!0}else t.removeTextContent(),t.removeTextConfig(),t.disableLabelAnimation=null}function nt(e,t,o,i,n,a){e.data?e.data.setItemGraphicEl(a,t):g(t).eventData={componentType:"geo",componentIndex:n.componentIndex,geoIndex:n.componentIndex,name:o,region:i&&i.option||{}}}function at(e,t,o,i,n){e.data||m({el:t,componentModel:n,itemName:o,itemTooltipOption:i.get("tooltip")})}function rt(e,t,o,i,n){t.highDownSilentOnTouch=!!n.get("selectedMode");var a=i.getModel("emphasis"),r=a.get("focus");return v(t,r,a.get("blurScope")),e.isGeo&&y(t,n,o),r}var st=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o}return _(t,e),t.prototype.render=function(e,t,o,i){if(!i||"mapToggleSelect"!==i.type||i.from!==this.uid){var n=this.group;if(n.removeAll(),!e.getHostGeoModel()){if(this._mapDraw&&i&&"geoRoam"===i.type&&this._mapDraw.resetForLabelLayout(),i&&"geoRoam"===i.type&&"series"===i.componentType&&i.seriesId===e.id)(a=this._mapDraw)&&n.add(a.group);else if(e.needsDrawMap){var a=this._mapDraw||new tt(o);n.add(a.group),a.draw(e,t,o,this,i),this._mapDraw=a}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;e.get("showLegendSymbol")&&t.getComponent("legend")&&this._renderSymbols(e,t,o)}}},t.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},t.prototype._renderSymbols=function(e,t,o){var i=e.originalData,n=this.group;i.each(i.mapDimension("value"),(function(t,o){if(!isNaN(t)){var a=i.getItemLayout(o);if(a&&a.point){var r=a.point,s=a.offset,l=new S({style:{fill:e.getData().getVisual("style").fill},shape:{cx:r[0]+9*s,cy:r[1],r:3},silent:!0,z2:8+(s?0:M+1)});if(!s){var p=e.mainSeries.getData(),u=i.getName(o),c=p.indexOfName(u),h=i.getItemModel(o),g=h.getModel("label"),m=p.getItemGraphicEl(c);d(l,f(h),{labelFetcher:{getFormattedLabel:function(t,o){return e.getFormattedLabel(c,o)}}}),l.disableLabelAnimation=!0,g.get("position")||l.setTextConfig({position:"bottom"}),m.onHoverStateChange=function(e){b(l,e)}}n.add(l)}}}))},t.type="map",t}(w),lt=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.type,e.needsDrawMap=!1,e.seriesGroup=[],e.getTooltipPosition=function(e){if(null!=e){var t=this.getData().getName(e),o=this.coordinateSystem,i=o.getRegion(t);return i&&o.dataToPoint(i.getCenter())}},e}return _(o,t),o.prototype.getInitialData=function(t){for(var o=Be(this,{coordDimensions:["value"],encodeDefaulter:x(T,this)}),i=e(),n=[],r=0,s=o.count();r<s;r++){var l=o.getName(r);i.set(l,!0)}var p=u.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);return a(p.regions,(function(e){var t=e.name;i.get(t)||n.push(t)})),o.appendValues([],n),o},o.prototype.getHostGeoModel=function(){var e=this.option.geoIndex;return null!=e?this.ecModel.getComponent("geo",e):null},o.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},o.prototype.getRawValue=function(e){var t=this.getData();return t.get(t.mapDimension("value"),e)},o.prototype.getRegionModel=function(e){var t=this.getData();return t.getItemModel(t.indexOfName(e))},o.prototype.formatTooltip=function(e,t,o){for(var i=this.getData(),n=this.getRawValue(e),a=i.getName(e),r=this.seriesGroup,s=[],l=0;l<r.length;l++){var p=r[l].originalData.indexOfName(a),u=i.mapDimension("value");isNaN(r[l].originalData.get(u,p))||s.push(r[l].name)}return V("section",{header:s.join(", "),noHeader:!s.length,blocks:[V("nameValue",{name:a,value:n})]})},o.prototype.setZoom=function(e){this.option.zoom=e},o.prototype.setCenter=function(e){this.option.center=e},o.prototype.getLegendIcon=function(e){var t=e.icon||"roundRect",o=C(t,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);return o.setStyle(e.itemStyle),o.style.stroke="none",t.indexOf("empty")>-1&&(o.style.stroke=o.style.fill,o.style.fill="#fff",o.style.lineWidth=2),o},o.type="series.map",o.dependencies=["geo"],o.layoutMode="box",o.defaultOption={zlevel:0,z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"},o}(D);function pt(e){var t={};e.eachSeriesByType("map",(function(e){var o=e.getHostGeoModel(),i=o?"o"+o.id:"i"+e.getMapType();(t[i]=t[i]||[]).push(e)})),a(t,(function(e,t){for(var o,i,n,r=(o=I(e,(function(e){return e.getData()})),i=e[0].get("mapValueCalculation"),n={},a(o,(function(e){e.each(e.mapDimension("value"),(function(t,o){var i="ec-"+e.getName(o);n[i]=n[i]||[],isNaN(t)||n[i].push(t)}))})),o[0].map(o[0].mapDimension("value"),(function(e,t){for(var a="ec-"+o[0].getName(t),r=0,s=1/0,l=-1/0,p=n[a].length,u=0;u<p;u++)s=Math.min(s,n[a][u]),l=Math.max(l,n[a][u]),r+=n[a][u];return 0===p?NaN:"min"===i?s:"max"===i?l:"average"===i?r/p:r}))),s=0;s<e.length;s++)e[s].originalData=e[s].getData();for(s=0;s<e.length;s++)e[s].seriesGroup=e,e[s].needsDrawMap=0===s&&!e[s].getHostGeoModel(),e[s].setData(r.cloneShallow()),e[s].mainSeries=e[0]}))}function ut(e){var t={};e.eachSeriesByType("map",(function(o){var i=o.getMapType();if(!o.getHostGeoModel()&&!t[i]){var n={};a(o.seriesGroup,(function(t){var o=t.coordinateSystem,i=t.originalData;t.get("showLegendSymbol")&&e.getComponent("legend")&&i.each(i.mapDimension("value"),(function(e,t){var a=i.getName(t),r=o.getRegion(a);if(r&&!isNaN(e)){var s=n[a]||0,l=o.dataToPoint(r.getCenter());n[a]=s+1,i.setItemLayout(t,{point:l,offset:s})}}))}));var r=o.getData();r.each((function(e){var t=r.getName(e),o=r.getItemLayout(e)||{};o.showLabel=!n[t],r.setItemLayout(e,o)})),t[i]=!0}}))}var ct=z,ht=function(e){function t(t){var o=e.call(this)||this;return o.type="view",o.dimensions=["x","y"],o._roamTransformable=new L,o._rawTransformable=new L,o.name=t,o}return _(t,e),t.prototype.setBoundingRect=function(e,t,o,i){return this._rect=new R(e,t,o,i),this._rect},t.prototype.getBoundingRect=function(){return this._rect},t.prototype.setViewRect=function(e,t,o,i){this._transformTo(e,t,o,i),this._viewRect=new R(e,t,o,i)},t.prototype._transformTo=function(e,t,o,i){var n=this.getBoundingRect(),a=this._rawTransformable;a.transform=n.calculateTransform(new R(e,t,o,i));var r=a.parent;a.parent=null,a.decomposeTransform(),a.parent=r,this._updateTransform()},t.prototype.setCenter=function(e){e&&(this._center=e,this._updateCenterAndZoom())},t.prototype.setZoom=function(e){e=e||1;var t=this.zoomLimit;t&&(null!=t.max&&(e=Math.min(t.max,e)),null!=t.min&&(e=Math.max(t.min,e))),this._zoom=e,this._updateCenterAndZoom()},t.prototype.getDefaultCenter=function(){var e=this.getBoundingRect();return[e.x+e.width/2,e.y+e.height/2]},t.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},t.prototype.getZoom=function(){return this._zoom||1},t.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},t.prototype._updateCenterAndZoom=function(){var e=this._rawTransformable.getLocalTransform(),t=this._roamTransformable,o=this.getDefaultCenter(),i=this.getCenter(),n=this.getZoom();i=z([],i,e),o=z([],o,e),t.originX=i[0],t.originY=i[1],t.x=o[0]-i[0],t.y=o[1]-i[1],t.scaleX=t.scaleY=n,this._updateTransform()},t.prototype._updateTransform=function(){var e=this._roamTransformable,t=this._rawTransformable;t.parent=e,e.updateTransform(),t.updateTransform(),O(this.transform||(this.transform=[]),t.transform||G()),this._rawTransform=t.getLocalTransform(),this.invTransform=this.invTransform||[],A(this.invTransform,this.transform),this.decomposeTransform()},t.prototype.getTransformInfo=function(){var e=this._rawTransformable,t=this._roamTransformable,o=new L;return o.transform=t.transform,o.decomposeTransform(),{roam:{x:o.x,y:o.y,scaleX:o.scaleX,scaleY:o.scaleY},raw:{x:e.x,y:e.y,scaleX:e.scaleX,scaleY:e.scaleY}}},t.prototype.getViewRect=function(){return this._viewRect},t.prototype.getViewRectAfterRoam=function(){var e=this.getBoundingRect().clone();return e.applyTransform(this.transform),e},t.prototype.dataToPoint=function(e,t,o){var i=t?this._rawTransform:this.transform;return o=o||[],i?ct(o,e,i):H(o,e)},t.prototype.pointToData=function(e){var t=this.invTransform;return t?ct([],e,t):[e[0],e[1]]},t.prototype.convertToPixel=function(e,t,o){var i=dt(t);return i===this?i.dataToPoint(o):null},t.prototype.convertFromPixel=function(e,t,o){var i=dt(t);return i===this?i.pointToData(o):null},t.prototype.containPoint=function(e){return this.getViewRectAfterRoam().contain(e[0],e[1])},t.dimensions=["x","y"],t}(L);function dt(e){var t=e.seriesModel;return t?t.coordinateSystem:null}var ft={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},gt=function(t){function o(o,i,n){var a=t.call(this,o)||this;a.dimensions=["lng","lat"],a.type="geo",a._nameCoordMap=e(),a.map=i;var r=u.load(i,n.nameMap,n.nameProperty),s=u.getGeoResource(i);a.resourceType=s?s.type:null;var l=ft[s.type];a._regionsMap=r.regionsMap,a._invertLongitute=l.invertLongitute,a.regions=r.regions,a.aspectScale=N(n.aspectScale,l.aspectScale);var p=r.boundingRect;return a.setBoundingRect(p.x,p.y,p.width,p.height),a}return _(o,t),o.prototype._transformTo=function(e,t,o,i){var n=this.getBoundingRect(),a=this._invertLongitute;n=n.clone(),a&&(n.y=-n.y-n.height);var r=this._rawTransformable;r.transform=n.calculateTransform(new R(e,t,o,i));var s=r.parent;r.parent=null,r.decomposeTransform(),r.parent=s,a&&(r.scaleY=-r.scaleY),this._updateTransform()},o.prototype.getRegion=function(e){return this._regionsMap.get(e)},o.prototype.getRegionByCoord=function(e){for(var t=this.regions,o=0;o<t.length;o++){var i=t[o];if("geoJSON"===i.type&&i.contain(e))return t[o]}},o.prototype.addGeoCoord=function(e,t){this._nameCoordMap.set(e,t)},o.prototype.getGeoCoord=function(e){var t=this._regionsMap.get(e);return this._nameCoordMap.get(e)||t&&t.getCenter()},o.prototype.dataToPoint=function(e,t,o){if("string"==typeof e&&(e=this.getGeoCoord(e)),e)return ht.prototype.dataToPoint.call(this,e,t,o)},o.prototype.convertToPixel=function(e,t,o){var i=mt(t);return i===this?i.dataToPoint(o):null},o.prototype.convertFromPixel=function(e,t,o){var i=mt(t);return i===this?i.pointToData(o):null},o}(ht);function mt(e){var t=e.geoModel,o=e.seriesModel;return t?t.coordinateSystem:o?o.coordinateSystem||(o.getReferringComponents("geo",P).models[0]||{}).coordinateSystem:null}function vt(e,t){var o=e.get("boundingCoords");if(null!=o){var i=o[0],n=o[1];isNaN(i[0])||isNaN(i[1])||isNaN(n[0])||isNaN(n[1])||this.setBoundingRect(i[0],i[1],n[0]-i[0],n[1]-i[1])}var a,r,s,l=this.getBoundingRect(),p=e.get("layoutCenter"),u=e.get("layoutSize"),c=t.getWidth(),h=t.getHeight(),d=l.width/l.height*this.aspectScale,f=!1;if(p&&u&&(a=[F(p[0],c),F(p[1],h)],r=F(u,Math.min(c,h)),isNaN(a[0])||isNaN(a[1])||isNaN(r)||(f=!0)),f)s={},d>1?(s.width=r,s.height=r/d):(s.height=r,s.width=r*d),s.y=a[1]-s.height/2,s.x=a[0]-s.width/2;else{var g=e.getBoxLayoutParams();g.aspect=d,s=Y(g,{width:c,height:h})}this.setViewRect(s.x,s.y,s.width,s.height),this.setCenter(e.get("center")),this.setZoom(e.get("zoom"))}E(gt,ht);var yt=new(function(){function t(){this.dimensions=gt.prototype.dimensions}return t.prototype.create=function(e,t){var o=[];e.eachComponent("geo",(function(e,i){var n=e.get("map"),a=new gt(n+i,n,{nameMap:e.get("nameMap"),nameProperty:e.get("nameProperty"),aspectScale:e.get("aspectScale")});a.zoomLimit=e.get("scaleLimit"),o.push(a),e.coordinateSystem=a,a.model=e,a.resize=vt,a.resize(e,t)})),e.eachSeries((function(e){if("geo"===e.get("coordinateSystem")){var t=e.get("geoIndex")||0;e.coordinateSystem=o[t]}}));var i={};return e.eachSeriesByType("map",(function(e){if(!e.getHostGeoModel()){var t=e.getMapType();i[t]=i[t]||[],i[t].push(e)}})),a(i,(function(e,i){var n=I(e,(function(e){return e.get("nameMap")})),r=new gt(i,i,{nameMap:k(n),nameProperty:e[0].get("nameProperty"),aspectScale:e[0].get("aspectScale")});r.zoomLimit=B.apply(null,I(e,(function(e){return e.get("scaleLimit")}))),o.push(r),r.resize=vt,r.resize(e[0],t),a(e,(function(e){e.coordinateSystem=r,function(e,t){a(t.get("geoCoord"),(function(t,o){e.addGeoCoord(o,t)}))}(r,e)}))})),o},t.prototype.getFilledRegions=function(t,o,i,n){for(var r=(t||[]).slice(),s=e(),l=0;l<r.length;l++)s.set(r[l].name,r[l]);var p=u.load(o,i,n);return a(p.regions,(function(e){var t=e.name;!s.get(t)&&r.push({name:t})})),r},t}()),_t=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.type,e}return _(o,t),o.prototype.init=function(e,t,o){var i=u.getGeoResource(e.map);if(i&&"geoJSON"===i.type){var n=e.itemStyle=e.itemStyle||{};"color"in n||(n.color="#eee")}this.mergeDefaultAndTheme(e,o),X(e,"label",["show"])},o.prototype.optionUpdated=function(){var t=this,o=this.option;o.regions=yt.getFilledRegions(o.regions,o.map,o.nameMap,o.nameProperty);var i={};this._optionModelMap=Z(o.regions||[],(function(e,o){var n=o.name;return n&&(e.set(n,new W(o,t,t.ecModel)),o.selected&&(i[n]=!0)),e}),e()),o.selectedMap||(o.selectedMap=i)},o.prototype.getRegionModel=function(e){return this._optionModelMap.get(e)||new W(null,this,this.ecModel)},o.prototype.getFormattedLabel=function(e,t){var o=this.getRegionModel(e),i="normal"===t?o.get(["label","formatter"]):o.get(["emphasis","label","formatter"]),n={name:e};return"function"==typeof i?(n.status=t,i(n)):"string"==typeof i?i.replace("{a}",null!=e?e:""):void 0},o.prototype.setZoom=function(e){this.option.zoom=e},o.prototype.setCenter=function(e){this.option.center=e},o.prototype.select=function(e){var t=this.option,o=t.selectedMode;o&&("multiple"!==o&&(t.selectedMap=null),(t.selectedMap||(t.selectedMap={}))[e]=!0)},o.prototype.unSelect=function(e){var t=this.option.selectedMap;t&&(t[e]=!1)},o.prototype.toggleSelected=function(e){this[this.isSelected(e)?"unSelect":"select"](e)},o.prototype.isSelected=function(e){var t=this.option.selectedMap;return!(!t||!t[e])},o.type="geo",o.layoutMode="box",o.defaultOption={zlevel:0,z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},o}(j);function St(e,t,o){var i=e.getZoom(),n=e.getCenter(),a=t.zoom,r=e.dataToPoint(n);if(null!=t.dx&&null!=t.dy&&(r[0]-=t.dx,r[1]-=t.dy,e.setCenter(e.pointToData(r))),null!=a){if(o){var s=o.min||0,l=o.max||1/0;a=Math.max(Math.min(i*a,l),s)/i}e.scaleX*=a,e.scaleY*=a;var p=(t.originX-e.x)*(a-1),u=(t.originY-e.y)*(a-1);e.x-=p,e.y-=u,e.updateTransform(),e.setCenter(e.pointToData(r)),e.setZoom(a*i)}return{center:e.getCenter(),zoom:e.getZoom()}}var Mt=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o.focusBlurEnabled=!0,o}return _(t,e),t.prototype.init=function(e,t){var o=new tt(t);this._mapDraw=o,this.group.add(o.group),this._api=t},t.prototype.render=function(e,t,o,i){var n=this._mapDraw;e.get("show")?n.draw(e,t,o,this,i):this._mapDraw.group.removeAll(),n.group.on("click",this._handleRegionClick,this),n.group.silent=e.get("silent"),this._model=e,this.updateSelectStatus(e,t,o)},t.prototype._handleRegionClick=function(e){var t;J(e.target,(function(e){return null!=(t=g(e).eventData)}),!0),t&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:t.name})},t.prototype.updateSelectStatus=function(e,t,o){var i=this;this._mapDraw.group.traverse((function(e){var t=g(e).eventData;if(t)return i._model.isSelected(t.name)?o.enterSelect(e):o.leaveSelect(e),!0}))},t.prototype.findHighDownDispatchers=function(e){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(e,this._model)},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},t.type="geo",t}(K);function bt(e){function t(t,o){o.update="geo:updateSelectStatus",e.registerAction(o,(function(e,o){var i={},n=[];return o.eachComponent({mainType:"geo",query:e},(function(o){o[t](e.name);var r=o.coordinateSystem;a(r.regions,(function(e){i[e.name]=o.isSelected(e.name)||!1}));var s=[];a(i,(function(e,t){i[t]&&s.push(t)})),n.push({geoIndex:o.componentIndex,name:s})})),{selected:i,allSelected:n,name:e.name}}))}e.registerCoordinateSystem("geo",yt),e.registerComponentModel(_t),e.registerComponentView(Mt),t("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),t("select",{type:"geoSelect",event:"geoselected"}),t("unSelect",{type:"geoUnSelect",event:"geounselected"}),e.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},(function(e,t){var o=e.componentType||"series";t.eachComponent({mainType:o,query:e},(function(t){var i=t.coordinateSystem;if("geo"===i.type){var n=St(i,e,t.get("scaleLimit"));t.setCenter&&t.setCenter(n.center),t.setZoom&&t.setZoom(n.zoom),"series"===o&&a(t.seriesGroup,(function(e){e.setCenter(n.center),e.setZoom(n.zoom)}))}}))}))}function wt(e){U(bt),e.registerChartView(st),e.registerSeriesModel(lt),e.registerLayout(ut),e.registerProcessor(e.PRIORITY.PROCESSOR.STATISTIC,pt),q("map",e.registerAction)}var xt=a,Tt=oe,Vt=function(){function e(t){var o=t.mappingMethod,i=t.type,n=this.option=$(t);this.type=i,this.mappingMethod=o,this._normalizeData=Ht[o];var r=e.visualHandlers[i];this.applyVisual=r.applyVisual,this.getColorMapper=r.getColorMapper,this._normalizedToVisual=r._normalizedToVisual[o],"piecewise"===o?(Ct(n),function(e){var t=e.pieceList;e.hasSpecialVisual=!1,a(t,(function(t,o){t.originIndex=o,null!=t.visual&&(e.hasSpecialVisual=!0)}))}(n)):"category"===o?n.categories?function(e){var t=e.categories,o=e.categoryMap={},i=e.visual;if(xt(t,(function(e,t){o[e]=t})),!ie(i)){var n=[];oe(i)?xt(i,(function(e,t){var i=o[t];n[null!=i?i:-1]=e})):n[-1]=i,i=At(e,n)}for(var a=t.length-1;a>=0;a--)null==i[a]&&(delete o[t[a]],t.pop())}(n):Ct(n,!0):(Q("linear"!==o||n.dataExtent),Ct(n))}return e.prototype.mapValueToVisual=function(e){var t=this._normalizeData(e);return this._normalizedToVisual(t,e)},e.prototype.getNormalizer=function(){return ee(this._normalizeData,this)},e.listVisualTypes=function(){return te(e.visualHandlers)},e.isValidType=function(t){return e.visualHandlers.hasOwnProperty(t)},e.eachVisual=function(e,t,o){oe(e)?a(e,t,o):t.call(o,e)},e.mapVisual=function(t,o,i){var n,a=ie(t)?[]:oe(t)?{}:(n=!0,null);return e.eachVisual(t,(function(e,t){var r=o.call(i,e,t);n?a=r:a[t]=r})),a},e.retrieveVisuals=function(t){var o,i={};return t&&xt(e.visualHandlers,(function(e,n){t.hasOwnProperty(n)&&(i[n]=t[n],o=!0)})),o?i:null},e.prepareVisualTypes=function(e){if(ie(e))e=e.slice();else{if(!Tt(e))return[];var t=[];xt(e,(function(e,o){t.push(o)})),e=t}return e.sort((function(e,t){return"color"===t&&"color"!==e&&0===e.indexOf("color")?1:-1})),e},e.dependsOn=function(e,t){return"color"===t?!(!e||0!==e.indexOf(t)):e===t},e.findPieceIndex=function(e,t,o){for(var i,n=1/0,a=0,r=t.length;a<r;a++){var s=t[a].value;if(null!=s){if(s===e||"string"==typeof s&&s===e+"")return a;o&&c(s,a)}}for(a=0,r=t.length;a<r;a++){var l=t[a],p=l.interval,u=l.close;if(p){if(p[0]===-1/0){if(Nt(u[1],e,p[1]))return a}else if(p[1]===1/0){if(Nt(u[0],p[0],e))return a}else if(Nt(u[0],p[0],e)&&Nt(u[1],e,p[1]))return a;o&&c(p[0],a),o&&c(p[1],a)}}if(o)return e===1/0?t.length-1:e===-1/0?0:i;function c(t,o){var a=Math.abs(t-e);a<n&&(n=a,i=o)}},e.visualHandlers={color:{applyVisual:Lt("color"),getColorMapper:function(){var e=this.option;return ee("category"===e.mappingMethod?function(e,t){return!t&&(e=this._normalizeData(e)),Rt.call(this,e)}:function(t,o,i){var n=!!i;return!o&&(t=this._normalizeData(t)),i=ne(t,e.parsedVisual,i),n?i:ae(i,"rgba")},this)},_normalizedToVisual:{linear:function(e){return ae(ne(e,this.option.parsedVisual),"rgba")},category:Rt,piecewise:function(e,t){var o=Gt.call(this,t);return null==o&&(o=ae(ne(e,this.option.parsedVisual),"rgba")),o},fixed:zt}},colorHue:Dt((function(e,t){return se(e,t)})),colorSaturation:Dt((function(e,t){return se(e,null,t)})),colorLightness:Dt((function(e,t){return se(e,null,null,t)})),colorAlpha:Dt((function(e,t){return le(e,t)})),decal:{applyVisual:Lt("decal"),_normalizedToVisual:{linear:null,category:Rt,piecewise:null,fixed:null}},opacity:{applyVisual:Lt("opacity"),_normalizedToVisual:Ot([0,1])},liftZ:{applyVisual:Lt("liftZ"),_normalizedToVisual:{linear:zt,category:zt,piecewise:zt,fixed:zt}},symbol:{applyVisual:function(e,t,o){o("symbol",this.mapValueToVisual(e))},_normalizedToVisual:{linear:It,category:Rt,piecewise:function(e,t){var o=Gt.call(this,t);return null==o&&(o=It.call(this,e)),o},fixed:zt}},symbolSize:{applyVisual:Lt("symbolSize"),_normalizedToVisual:Ot([0,1])}},e}();function Ct(e,t){var o=e.visual,i=[];oe(o)?xt(o,(function(e){i.push(e)})):null!=o&&i.push(o);t||1!==i.length||{color:1,symbol:1}.hasOwnProperty(e.type)||(i[1]=i[0]),At(e,i)}function Dt(e){return{applyVisual:function(t,o,i){var n=this.mapValueToVisual(t);i("color",e(o("color"),n))},_normalizedToVisual:Ot([0,1])}}function It(e){var t=this.option.visual;return t[Math.round(re(e,[0,1],[0,t.length-1],!0))]||{}}function Lt(e){return function(t,o,i){i(e,this.mapValueToVisual(t))}}function Rt(e){var t=this.option.visual;return t[this.option.loop&&-1!==e?e%t.length:e]}function zt(){return this.option.visual[0]}function Ot(e){return{linear:function(t){return re(t,e,this.option.visual,!0)},category:Rt,piecewise:function(t,o){var i=Gt.call(this,o);return null==i&&(i=re(t,e,this.option.visual,!0)),i},fixed:zt}}function Gt(e){var t=this.option,o=t.pieceList;if(t.hasSpecialVisual){var i=o[Vt.findPieceIndex(e,o)];if(i&&i.visual)return i.visual[this.type]}}function At(e,t){return e.visual=t,"color"===e.type&&(e.parsedVisual=I(t,(function(e){return pe(e)}))),t}var Ht={linear:function(e){return re(e,this.option.dataExtent,[0,1],!0)},piecewise:function(e){var t=this.option.pieceList,o=Vt.findPieceIndex(e,t,!0);if(null!=o)return re(o,[0,t.length-1],[0,1],!0)},category:function(e){var t=this.option.categories?this.option.categoryMap[e]:e;return null==t?-1:t},fixed:ue};function Nt(e,t,o){return e?t<=o:t<o}function Pt(e,t){var o=t.rippleEffectColor||t.color;e.eachChild((function(e){e.attr({z:t.z,zlevel:t.zlevel,style:{stroke:"stroke"===t.brushType?o:null,fill:"fill"===t.brushType?o:null}})}))}var Et=function(e){function t(t,i){var n=e.call(this)||this,a=new Fe(t,i),r=new o;return n.add(a),n.add(r),n.updateData(t,i),n}return _(t,e),t.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},t.prototype.startEffectAnimation=function(e){for(var t=e.symbolType,o=e.color,i=this.childAt(1),n=0;n<3;n++){var a=C(t,-1,-1,2,2,o);a.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var r=-n/3*e.period+e.effectOffset;a.animate("",!0).when(e.period,{scaleX:e.rippleScale/2,scaleY:e.rippleScale/2}).delay(r).start(),a.animateStyle(!0).when(e.period,{opacity:0}).delay(r).start(),i.add(a)}Pt(i,e)},t.prototype.updateEffectAnimation=function(e){for(var t=this._effectCfg,o=this.childAt(1),i=["symbolType","period","rippleScale"],n=0;n<i.length;n++){var a=i[n];if(t[a]!==e[a])return this.stopEffectAnimation(),void this.startEffectAnimation(e)}Pt(o,e)},t.prototype.highlight=function(){ce(this)},t.prototype.downplay=function(){he(this)},t.prototype.updateData=function(e,t){var o=this,i=e.hostModel;this.childAt(0).updateData(e,t);var n=this.childAt(1),a=e.getItemModel(t),r=e.getItemVisual(t,"symbol"),s=function(e){return ie(e)||(e=[+e,+e]),e}(e.getItemVisual(t,"symbolSize")),l=e.getItemVisual(t,"style"),p=l&&l.fill;n.setScale(s),n.traverse((function(e){e.setStyle("fill",p)}));var u=e.getItemVisual(t,"symbolOffset");u&&(ie(u)||(u=[u,u]),n.x=F(u[0],s[0]),n.y=F(N(u[1],u[0])||0,s[1]));var c=e.getItemVisual(t,"symbolRotate");n.rotation=(c||0)*Math.PI/180||0;var h={};h.showEffectOn=i.get("showEffectOn"),h.rippleScale=a.get(["rippleEffect","scale"]),h.brushType=a.get(["rippleEffect","brushType"]),h.period=1e3*a.get(["rippleEffect","period"]),h.effectOffset=t/e.count(),h.z=i.getShallow("z")||0,h.zlevel=i.getShallow("zlevel")||0,h.symbolType=r,h.color=p,h.rippleEffectColor=a.get(["rippleEffect","color"]),this.off("mouseover").off("mouseout").off("emphasis").off("normal"),"render"===h.showEffectOn?(this._effectCfg?this.updateEffectAnimation(h):this.startEffectAnimation(h),this._effectCfg=h):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(e){"emphasis"===e?"render"!==h.showEffectOn&&o.startEffectAnimation(h):"normal"===e&&"render"!==h.showEffectOn&&o.stopEffectAnimation()}),this._effectCfg=h,v(this)},t.prototype.fadeOut=function(e){this.off("mouseover").off("mouseout"),e&&e()},t}(o),kt=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o}return _(t,e),t.prototype.init=function(){this._symbolDraw=new Ye(Et)},t.prototype.render=function(e,t,o){var i=e.getData(),n=this._symbolDraw;n.updateData(i,{clipShape:this._getClipShape(e)}),this.group.add(n.group)},t.prototype._getClipShape=function(e){var t=e.coordinateSystem,o=t&&t.getArea&&t.getArea();return e.get("clip",!0)?o:null},t.prototype.updateTransform=function(e,t,o){var i=e.getData();this.group.dirty();var n=Xe("").reset(e,t,o);n.progress&&n.progress({start:0,end:i.count(),count:i.count()},i),this._symbolDraw.updateLayout()},t.prototype._updateGroupTransform=function(e){var t=e.coordinateSystem;t&&t.getRoamTransform&&(this.group.transform=de(t.getRoamTransform()),this.group.decomposeTransform())},t.prototype.remove=function(e,t){this._symbolDraw&&this._symbolDraw.remove(!0)},t.type="effectScatter",t}(w),Bt=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o.hasSymbolVisual=!0,o}return _(t,e),t.prototype.getInitialData=function(e,t){return Ze(this.getSource(),this,{useEncodeDefaulter:!0})},t.prototype.brushSelector=function(e,t,o){return o.point(t.getItemLayout(e))},t.type="series.effectScatter",t.dependencies=["grid","polar"],t.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill"},symbolSize:10},t}(D);function Ft(e){e.registerChartView(kt),e.registerSeriesModel(Bt),e.registerLayout(Xe("effectScatter"))}var Yt=a;function Xt(e){if(e)for(var t in e)if(e.hasOwnProperty(t))return!0}function Zt(e,t,o){var i={};return Yt(t,(function(t){var n,a=i[t]=((n=function(){}).prototype.__hidden=n.prototype,new n);Yt(e[t],(function(e,i){if(Vt.isValidType(i)){var n={type:i,visual:e};o&&o(n,t),a[i]=new Vt(n),"opacity"===i&&((n=$(n)).type="colorAlpha",a.__hidden.__alphaForOpacity=new Vt(n))}}))})),i}function Wt(e,t,o){var i;a(o,(function(e){t.hasOwnProperty(e)&&Xt(t[e])&&(i=!0)})),i&&a(o,(function(o){t.hasOwnProperty(o)&&Xt(t[o])?e[o]=$(t[o]):delete e[o]}))}function jt(e,t,o,i,n,r){var s,l={};function p(e){return fe(o,s,e)}function u(e,t){ge(o,s,e,t)}function c(e,a){s=null==r?e:a;var c=o.getRawDataItem(s);if(!c||!1!==c.visualMap)for(var h=i.call(n,e),d=t[h],f=l[h],g=0,m=f.length;g<m;g++){var v=f[g];d[v]&&d[v].applyVisual(e,p,u)}}a(e,(function(e){var o=Vt.prepareVisualTypes(t[e]);l[e]=o})),null==r?o.each(c):o.each([r],c)}var Jt=function(e,t,o){var i=$((Kt[e]||{})[t]);return o&&ie(i)?i[i.length-1]:i},Kt={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}},Ut=Vt.mapVisual,qt=Vt.eachVisual,$t=ie,Qt=a,eo=Me,to=re,oo=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o.stateList=["inRange","outOfRange"],o.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],o.layoutMode={type:"box",ignoreSize:!0},o.dataBound=[-1/0,1/0],o.targetVisuals={},o.controllerVisuals={},o}return _(t,e),t.prototype.init=function(e,t,o){this.mergeDefaultAndTheme(e,o)},t.prototype.optionUpdated=function(e,t){var o=this.option;me.canvasSupported||(o.realtime=!1),!t&&Wt(o,e,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},t.prototype.resetVisual=function(e){var t=this.stateList;e=ee(e,this),this.controllerVisuals=Zt(this.option.controller,t,e),this.targetVisuals=Zt(this.option.target,t,e)},t.prototype.getItemSymbol=function(){return null},t.prototype.getTargetSeriesIndices=function(){var e=this.option.seriesIndex,t=[];return null==e||"all"===e?this.ecModel.eachSeries((function(e,o){t.push(o)})):t=ve(e),t},t.prototype.eachTargetSeries=function(e,t){a(this.getTargetSeriesIndices(),(function(o){var i=this.ecModel.getSeriesByIndex(o);i&&e.call(t,i)}),this)},t.prototype.isTargetSeries=function(e){var t=!1;return this.eachTargetSeries((function(o){o===e&&(t=!0)})),t},t.prototype.formatValueText=function(e,t,o){var i,n=this.option,a=n.precision,r=this.dataBound,s=n.formatter;o=o||["<",">"],ie(e)&&(e=e.slice(),i=!0);var l=t?e:i?[p(e[0]),p(e[1])]:p(e);return ye(s)?s.replace("{value}",i?l[0]:l).replace("{value2}",i?l[1]:l):_e(s)?i?s(e[0],e[1]):s(e):i?e[0]===r[0]?o[0]+" "+l[1]:e[1]===r[1]?o[1]+" "+l[0]:l[0]+" - "+l[1]:l;function p(e){return e===r[0]?"min":e===r[1]?"max":(+e).toFixed(Math.min(a,20))}},t.prototype.resetExtent=function(){var e=this.option,t=eo([e.min,e.max]);this._dataExtent=t},t.prototype.getDataDimension=function(e){var t=this.option.dimension,o=e.dimensions;if(null!=t||o.length){if(null!=t)return e.getDimension(t);for(var i=e.dimensions,n=i.length-1;n>=0;n--){var a=i[n];if(!e.getDimensionInfo(a).isCalculationCoord)return a}}},t.prototype.getExtent=function(){return this._dataExtent.slice()},t.prototype.completeVisualOption=function(){var e=this.ecModel,t=this.option,o={inRange:t.inRange,outOfRange:t.outOfRange},i=t.target||(t.target={}),n=t.controller||(t.controller={});Se(i,o),Se(n,o);var a=this.isCategory();function r(o){$t(t.color)&&!o.inRange&&(o.inRange={color:t.color.slice().reverse()}),o.inRange=o.inRange||{color:e.get("gradientColor")}}r.call(this,i),r.call(this,n),function(e,t,o){var i=e[t],n=e[o];i&&!n&&(n=e[o]={},Qt(i,(function(e,t){if(Vt.isValidType(t)){var o=Jt(t,"inactive",a);null!=o&&(n[t]=o,"color"!==t||n.hasOwnProperty("opacity")||n.hasOwnProperty("colorAlpha")||(n.opacity=[0,0]))}})))}.call(this,i,"inRange","outOfRange"),function(e){var t=(e.inRange||{}).symbol||(e.outOfRange||{}).symbol,o=(e.inRange||{}).symbolSize||(e.outOfRange||{}).symbolSize,i=this.get("inactiveColor"),n=this.getItemSymbol()||"roundRect";Qt(this.stateList,(function(r){var s=this.itemSize,l=e[r];l||(l=e[r]={color:a?i:[i]}),null==l.symbol&&(l.symbol=t&&$(t)||(a?n:[n])),null==l.symbolSize&&(l.symbolSize=o&&$(o)||(a?s[0]:[s[0],s[0]])),l.symbol=Ut(l.symbol,(function(e){return"none"===e?n:e}));var p=l.symbolSize;if(null!=p){var u=-1/0;qt(p,(function(e){e>u&&(u=e)})),l.symbolSize=Ut(p,(function(e){return to(e,[0,u],[0,s[0]],!0)}))}}),this)}.call(this,n)},t.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},t.prototype.isCategory=function(){return!!this.option.categories},t.prototype.setSelected=function(e){},t.prototype.getSelected=function(){return null},t.prototype.getValueState=function(e){return null},t.prototype.getVisualMeta=function(e){return null},t.type="visualMap",t.dependencies=["series"],t.defaultOption={show:!0,zlevel:0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}},t}(j),io=[20,140],no=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o}return _(t,e),t.prototype.optionUpdated=function(t,o){e.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual((function(e){e.mappingMethod="linear",e.dataExtent=this.getExtent()})),this._resetRange()},t.prototype.resetItemSize=function(){e.prototype.resetItemSize.apply(this,arguments);var t=this.itemSize;(null==t[0]||isNaN(t[0]))&&(t[0]=io[0]),(null==t[1]||isNaN(t[1]))&&(t[1]=io[1])},t.prototype._resetRange=function(){var e=this.getExtent(),t=this.option.range;!t||t.auto?(e.auto=1,this.option.range=e):ie(t)&&(t[0]>t[1]&&t.reverse(),t[0]=Math.max(t[0],e[0]),t[1]=Math.min(t[1],e[1]))},t.prototype.completeVisualOption=function(){e.prototype.completeVisualOption.apply(this,arguments),a(this.stateList,(function(e){var t=this.option.controller[e].symbolSize;t&&t[0]!==t[1]&&(t[0]=t[1]/3)}),this)},t.prototype.setSelected=function(e){this.option.range=e.slice(),this._resetRange()},t.prototype.getSelected=function(){var e=this.getExtent(),t=Me((this.get("range")||[]).slice());return t[0]>e[1]&&(t[0]=e[1]),t[1]>e[1]&&(t[1]=e[1]),t[0]<e[0]&&(t[0]=e[0]),t[1]<e[0]&&(t[1]=e[0]),t},t.prototype.getValueState=function(e){var t=this.option.range,o=this.getExtent();return(t[0]<=o[0]||t[0]<=e)&&(t[1]>=o[1]||e<=t[1])?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var t=[];return this.eachTargetSeries((function(o){var i=[],n=o.getData();n.each(this.getDataDimension(n),(function(t,o){e[0]<=t&&t<=e[1]&&i.push(o)}),this),t.push({seriesId:o.id,dataIndex:i})}),this),t},t.prototype.getVisualMeta=function(e){var t=ao(this,"outOfRange",this.getExtent()),o=ao(this,"inRange",this.option.range.slice()),i=[];function n(t,o){i.push({value:t,color:e(t,o)})}for(var a=0,r=0,s=o.length,l=t.length;r<l&&(!o.length||t[r]<=o[0]);r++)t[r]<o[a]&&n(t[r],"outOfRange");for(var p=1;a<s;a++,p=0)p&&i.length&&n(o[a],"outOfRange"),n(o[a],"inRange");for(p=1;r<l;r++)(!o.length||o[o.length-1]<t[r])&&(p&&(i.length&&n(i[i.length-1].value,"outOfRange"),p=0),n(t[r],"outOfRange"));var u=i.length;return{stops:i,outerColors:[u?i[0].color:"transparent",u?i[u-1].color:"transparent"]}},t.type="visualMap.continuous",t.defaultOption=be(oo.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}}),t}(oo);function ao(e,t,o){if(o[0]===o[1])return o.slice();for(var i=(o[1]-o[0])/200,n=o[0],a=[],r=0;r<=200&&n<o[1];r++)a.push(n),n+=i;return a.push(o[1]),a}var ro=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o.autoPositionValues={left:1,right:1,top:1,bottom:1},o}return _(t,e),t.prototype.init=function(e,t){this.ecModel=e,this.api=t},t.prototype.render=function(e,t,o,i){this.visualMapModel=e,!1!==e.get("show")?this.doRender(e,t,o,i):this.group.removeAll()},t.prototype.renderBackground=function(e){var t=this.visualMapModel,o=we(t.get("padding")||0),i=e.getBoundingRect();e.add(new xe({z2:-1,silent:!0,shape:{x:i.x-o[3],y:i.y-o[0],width:i.width+o[3]+o[1],height:i.height+o[0]+o[2]},style:{fill:t.get("backgroundColor"),stroke:t.get("borderColor"),lineWidth:t.get("borderWidth")}}))},t.prototype.getControllerVisual=function(e,t,o){var i=(o=o||{}).forceState,n=this.visualMapModel,r={};if("color"===t){var s=n.get("contentColor");r.color=s}function l(e){return r[e]}function p(e,t){r[e]=t}var u=n.controllerVisuals[i||n.getValueState(e)],c=Vt.prepareVisualTypes(u);return a(c,(function(i){var n=u[i];o.convertOpacityToAlpha&&"opacity"===i&&(i="colorAlpha",n=u.__alphaForOpacity),Vt.dependsOn(i,t)&&n&&n.applyVisual(e,l,p)})),r[t]},t.prototype.positionGroup=function(e){var t=this.visualMapModel,o=this.api;Te(e,t.getBoxLayoutParams(),{width:o.getWidth(),height:o.getHeight()})},t.prototype.doRender=function(e,t,o,i){},t.type="visualMap",t}(K),so=[["left","right","width"],["top","bottom","height"]];function lo(e,t,o){var i=e.option,n=i.align;if(null!=n&&"auto"!==n)return n;for(var a={width:t.getWidth(),height:t.getHeight()},r="horizontal"===i.orient?1:0,s=so[r],l=[0,null,10],p={},u=0;u<3;u++)p[so[1-r][u]]=l[u],p[s[u]]=2===u?o[0]:i[s[u]];var c=[["x","width",3],["y","height",0]][r],h=Y(p,a,i.padding);return s[(h.margin[c[2]]||0)+h[c[0]]+.5*h[c[1]]<.5*a[c[1]]?0:1]}function po(e,t){return a(e||[],(function(e){null!=e.dataIndex&&(e.dataIndexInside=e.dataIndex,e.dataIndex=null),e.highlightKey="visualMap"+(t?t.componentIndex:"")})),e}var uo=re,co=a,ho=Math.min,fo=Math.max,go=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o._shapes={},o._dataInterval=[],o._handleEnds=[],o._hoverLinkDataIndices=[],o}return _(t,e),t.prototype.doRender=function(e,t,o,i){this._api=o,i&&"selectDataRange"===i.type&&i.from===this.uid||this._buildView()},t.prototype._buildView=function(){this.group.removeAll();var e=this.visualMapModel,t=this.group;this._orient=e.get("orient"),this._useHandle=e.get("calculable"),this._resetInterval(),this._renderBar(t);var o=e.get("text");this._renderEndsText(t,o,0),this._renderEndsText(t,o,1),this._updateView(!0),this.renderBackground(t),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(t)},t.prototype._renderEndsText=function(e,t,o){if(t){var i=t[1-o];i=null!=i?i+"":"";var n=this.visualMapModel,a=n.get("textGap"),r=n.itemSize,s=this._shapes.mainGroup,l=this._applyTransform([r[0]/2,0===o?-a:r[1]+a],s),p=this._applyTransform(0===o?"bottom":"top",s),u=this._orient,c=this.visualMapModel.textStyleModel;this.group.add(new Ve({style:{x:l[0],y:l[1],verticalAlign:"horizontal"===u?"middle":p,align:"horizontal"===u?p:"center",text:i,font:c.getFont(),fill:c.getTextColor()}}))}},t.prototype._renderBar=function(e){var t=this.visualMapModel,i=this._shapes,n=t.itemSize,a=this._orient,r=this._useHandle,s=lo(t,this.api,n),l=i.mainGroup=this._createBarGroup(s),p=new o;l.add(p),p.add(i.outOfRange=mo()),p.add(i.inRange=mo(null,r?yo(this._orient):null,ee(this._dragHandle,this,"all",!1),ee(this._dragHandle,this,"all",!0))),p.setClipPath(new xe({shape:{x:0,y:0,width:n[0],height:n[1],r:3}}));var u=t.textStyleModel.getTextRect("国"),c=fo(u.width,u.height);r&&(i.handleThumbs=[],i.handleLabels=[],i.handleLabelPoints=[],this._createHandle(t,l,0,n,c,a),this._createHandle(t,l,1,n,c,a)),this._createIndicator(t,l,n,c,a),e.add(l)},t.prototype._createHandle=function(e,t,o,i,n,a){var r=ee(this._dragHandle,this,o,!1),s=ee(this._dragHandle,this,o,!0),l=De(e.get("handleSize"),i[0]),p=C(e.get("handleIcon"),-l/2,-l/2,l,l,null,!0),u=yo(this._orient);p.attr({cursor:u,draggable:!0,drift:r,ondragend:s,onmousemove:function(e){Ce(e.event)}}),p.x=i[0]/2,p.useStyle(e.getModel("handleStyle").getItemStyle()),p.setStyle({strokeNoScale:!0,strokeFirst:!0}),p.style.lineWidth*=2,p.ensureState("emphasis").style=e.getModel(["emphasis","handleStyle"]).getItemStyle(),Ie(p,!0),t.add(p);var c=this.visualMapModel.textStyleModel,h=new Ve({cursor:u,draggable:!0,drift:r,onmousemove:function(e){Ce(e.event)},ondragend:s,style:{x:0,y:0,text:"",font:c.getFont(),fill:c.getTextColor()}});h.ensureState("blur").style={opacity:.1},h.stateTransition={duration:200},this.group.add(h);var d=[l,0],f=this._shapes;f.handleThumbs[o]=p,f.handleLabelPoints[o]=d,f.handleLabels[o]=h},t.prototype._createIndicator=function(e,t,o,i,n){var a=De(e.get("indicatorSize"),o[0]),r=C(e.get("indicatorIcon"),-a/2,-a/2,a,a,null,!0);r.attr({cursor:"move",invisible:!0,silent:!0,x:o[0]/2});var s=e.getModel("indicatorStyle").getItemStyle();if(r instanceof Le){var l=r.style;r.useStyle(c({image:l.image,x:l.x,y:l.y,width:l.width,height:l.height},s))}else r.useStyle(s);t.add(r);var p=this.visualMapModel.textStyleModel,u=new Ve({silent:!0,invisible:!0,style:{x:0,y:0,text:"",font:p.getFont(),fill:p.getTextColor()}});this.group.add(u);var h=[("horizontal"===n?i/2:6)+o[0]/2,0],d=this._shapes;d.indicator=r,d.indicatorLabel=u,d.indicatorLabelPoint=h,this._firstShowIndicator=!0},t.prototype._dragHandle=function(e,t,o,i){if(this._useHandle){if(this._dragging=!t,!t){var n=this._applyTransform([o,i],this._shapes.mainGroup,!0);this._updateInterval(e,n[1]),this._hideIndicator(),this._updateView()}t===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),t?!this._hovering&&this._clearHoverLinkToSeries():vo(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[e],!1)}},t.prototype._resetInterval=function(){var e=this.visualMapModel,t=this._dataInterval=e.getSelected(),o=e.getExtent(),i=[0,e.itemSize[1]];this._handleEnds=[uo(t[0],o,i,!0),uo(t[1],o,i,!0)]},t.prototype._updateInterval=function(e,t){t=t||0;var o=this.visualMapModel,i=this._handleEnds,n=[0,o.itemSize[1]];We(t,i,n,e,0);var a=o.getExtent();this._dataInterval=[uo(i[0],n,a,!0),uo(i[1],n,a,!0)]},t.prototype._updateView=function(e){var t=this.visualMapModel,o=t.getExtent(),i=this._shapes,n=[0,t.itemSize[1]],a=e?n:this._handleEnds,r=this._createBarVisual(this._dataInterval,o,a,"inRange"),s=this._createBarVisual(o,o,n,"outOfRange");i.inRange.setStyle({fill:r.barColor}).setShape("points",r.barPoints),i.outOfRange.setStyle({fill:s.barColor}).setShape("points",s.barPoints),this._updateHandle(a,r)},t.prototype._createBarVisual=function(e,t,o,i){var n={forceState:i,convertOpacityToAlpha:!0},a=this._makeColorGradient(e,n),r=[this.getControllerVisual(e[0],"symbolSize",n),this.getControllerVisual(e[1],"symbolSize",n)],s=this._createBarPoints(o,r);return{barColor:new Re(0,0,0,1,a),barPoints:s,handlesColor:[a[0].color,a[a.length-1].color]}},t.prototype._makeColorGradient=function(e,t){var o=[],i=(e[1]-e[0])/100;o.push({color:this.getControllerVisual(e[0],"color",t),offset:0});for(var n=1;n<100;n++){var a=e[0]+i*n;if(a>e[1])break;o.push({color:this.getControllerVisual(a,"color",t),offset:n/100})}return o.push({color:this.getControllerVisual(e[1],"color",t),offset:1}),o},t.prototype._createBarPoints=function(e,t){var o=this.visualMapModel.itemSize;return[[o[0]-t[0],e[0]],[o[0],e[0]],[o[0],e[1]],[o[0]-t[1],e[1]]]},t.prototype._createBarGroup=function(e){var t=this._orient,i=this.visualMapModel.get("inverse");return new o("horizontal"!==t||i?"horizontal"===t&&i?{scaleX:"bottom"===e?-1:1,rotation:-Math.PI/2}:"vertical"!==t||i?{scaleX:"left"===e?1:-1}:{scaleX:"left"===e?1:-1,scaleY:-1}:{scaleX:"bottom"===e?1:-1,rotation:Math.PI/2})},t.prototype._updateHandle=function(e,t){if(this._useHandle){var o=this._shapes,i=this.visualMapModel,n=o.handleThumbs,a=o.handleLabels,r=i.itemSize,s=i.getExtent();co([0,1],(function(l){var p=n[l];p.setStyle("fill",t.handlesColor[l]),p.y=e[l];var u=uo(e[l],[0,r[1]],s,!0),c=this.getControllerVisual(u,"symbolSize");p.scaleX=p.scaleY=c/r[0],p.x=r[0]-c/2;var h=ze(o.handleLabelPoints[l],Oe(p,this.group));a[l].setStyle({x:h[0],y:h[1],text:i.formatValueText(this._dataInterval[l]),verticalAlign:"middle",align:"vertical"===this._orient?this._applyTransform("left",o.mainGroup):"center"})}),this)}},t.prototype._showIndicator=function(e,t,o,i){var n=this.visualMapModel,a=n.getExtent(),r=n.itemSize,s=[0,r[1]],l=this._shapes,p=l.indicator;if(p){p.attr("invisible",!1);var u=this.getControllerVisual(e,"color",{convertOpacityToAlpha:!0}),c=this.getControllerVisual(e,"symbolSize"),h=uo(e,a,s,!0),d=r[0]-c/2,f={x:p.x,y:p.y};p.y=h,p.x=d;var g=ze(l.indicatorLabelPoint,Oe(p,this.group)),m=l.indicatorLabel;m.attr("invisible",!1);var v=this._applyTransform("left",l.mainGroup),y="horizontal"===this._orient;m.setStyle({text:(o||"")+n.formatValueText(t),verticalAlign:y?v:"middle",align:y?"center":v});var _={x:d,y:h,style:{fill:u}},S={style:{x:g[0],y:g[1]}};if(n.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var M={duration:100,easing:"cubicInOut",additive:!0};p.x=f.x,p.y=f.y,p.animateTo(_,M),m.animateTo(S,M)}else p.attr(_),m.attr(S);this._firstShowIndicator=!1;var b=this._shapes.handleLabels;if(b)for(var w=0;w<b.length;w++)this._api.enterBlur(b[w])}},t.prototype._enableHoverLinkToSeries=function(){var e=this;this._shapes.mainGroup.on("mousemove",(function(t){if(e._hovering=!0,!e._dragging){var o=e.visualMapModel.itemSize,i=e._applyTransform([t.offsetX,t.offsetY],e._shapes.mainGroup,!0,!0);i[1]=ho(fo(0,i[1]),o[1]),e._doHoverLinkToSeries(i[1],0<=i[0]&&i[0]<=o[0])}})).on("mouseout",(function(){e._hovering=!1,!e._dragging&&e._clearHoverLinkToSeries()}))},t.prototype._enableHoverLinkFromSeries=function(){var e=this.api.getZr();this.visualMapModel.option.hoverLink?(e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),e.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},t.prototype._doHoverLinkToSeries=function(e,t){var o=this.visualMapModel,i=o.itemSize;if(o.option.hoverLink){var n=[0,i[1]],a=o.getExtent();e=ho(fo(n[0],e),n[1]);var r=function(e,t,o){var i=6,n=e.get("hoverLinkDataSize");n&&(i=uo(n,t,o,!0)/2);return i}(o,a,n),s=[e-r,e+r],l=uo(e,n,a,!0),p=[uo(s[0],n,a,!0),uo(s[1],n,a,!0)];s[0]<n[0]&&(p[0]=-1/0),s[1]>n[1]&&(p[1]=1/0),t&&(p[0]===-1/0?this._showIndicator(l,p[1],"< ",r):p[1]===1/0?this._showIndicator(l,p[0],"> ",r):this._showIndicator(l,l,"≈ ",r));var u=this._hoverLinkDataIndices,c=[];(t||vo(o))&&(c=this._hoverLinkDataIndices=o.findTargetDataIndices(p));var h=Ge(u,c);this._dispatchHighDown("downplay",po(h[0],o)),this._dispatchHighDown("highlight",po(h[1],o))}},t.prototype._hoverLinkFromSeriesMouseOver=function(e){var t=e.target,o=this.visualMapModel;if(t&&null!=g(t).dataIndex){var i=g(t),n=this.ecModel.getSeriesByIndex(i.seriesIndex);if(o.isTargetSeries(n)){var a=n.getData(i.dataType),r=a.get(o.getDataDimension(a),i.dataIndex);isNaN(r)||this._showIndicator(r,r)}}},t.prototype._hideIndicator=function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",!0),e.indicatorLabel&&e.indicatorLabel.attr("invisible",!0);var t=this._shapes.handleLabels;if(t)for(var o=0;o<t.length;o++)this._api.leaveBlur(t[o])},t.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",po(e,this.visualMapModel)),e.length=0},t.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver),e.off("mouseout",this._hideIndicator)},t.prototype._applyTransform=function(e,t,o,i){var n=Oe(t,i?null:this.group);return ie(e)?ze(e,n,o):Ae(e,n,o)},t.prototype._dispatchHighDown=function(e,t){t&&t.length&&this.api.dispatchAction({type:e,batch:t})},t.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},t.prototype.remove=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},t.type="visualMap.continuous",t}(ro);function mo(e,t,o,i){return new s({shape:{points:e},draggable:!!o,cursor:t,drift:o,onmousemove:function(e){Ce(e.event)},ondragend:i})}function vo(e){var t=e.get("hoverLinkOnHandle");return!!(null==t?e.get("realtime"):t)}function yo(e){return"vertical"===e?"ns-resize":"ew-resize"}var _o={type:"selectDataRange",event:"dataRangeSelected",update:"update"},So=function(e,t){t.eachComponent({mainType:"visualMap",query:e},(function(t){t.setSelected(e.selected)}))},Mo=[{createOnAllSeries:!0,reset:function(e,t){var o=[];return t.eachComponent("visualMap",(function(t){var i,n,r,s,l,p=e.pipelineContext;!t.isTargetSeries(e)||p&&p.large||o.push((i=t.stateList,n=t.targetVisuals,r=ee(t.getValueState,t),s=t.getDataDimension(e.getData()),l={},a(i,(function(e){var t=Vt.prepareVisualTypes(n[e]);l[e]=t})),{progress:function(e,t){var o,i;function a(e){return fe(t,i,e)}function p(e,o){ge(t,i,e,o)}for(null!=s&&(o=t.getDimension(s));null!=(i=e.next());){var u=t.getRawDataItem(i);if(!u||!1!==u.visualMap)for(var c=null!=s?t.get(o,i):i,h=r(c),d=n[h],f=l[h],g=0,m=f.length;g<m;g++){var v=f[g];d[v]&&d[v].applyVisual(c,a,p)}}}}))})),o}},{createOnAllSeries:!0,reset:function(e,t){var o=e.getData(),i=[];t.eachComponent("visualMap",(function(t){if(t.isTargetSeries(e)){var n=t.getVisualMeta(ee(bo,null,e,t))||{stops:[],outerColors:[]},a=t.getDataDimension(o),r=o.getDimensionInfo(a);null!=r&&(n.dimension=r.index,i.push(n))}})),e.getData().setVisual("visualMeta",i)}}];function bo(e,t,o,i){for(var n=t.targetVisuals[i],a=Vt.prepareVisualTypes(n),r={color:He(e.getData(),"color")},s=0,l=a.length;s<l;s++){var p=a[s],u=n["opacity"===p?"__alphaForOpacity":p];u&&u.applyVisual(o,c,h)}return r.color;function c(e){return r[e]}function h(e,t){r[e]=t}}var wo=a;function xo(e){var t=e&&e.visualMap;ie(t)||(t=t?[t]:[]),wo(t,(function(e){if(e){To(e,"splitList")&&!To(e,"pieces")&&(e.pieces=e.splitList,delete e.splitList);var t=e.pieces;t&&ie(t)&&wo(t,(function(e){oe(e)&&(To(e,"start")&&!To(e,"min")&&(e.min=e.start),To(e,"end")&&!To(e,"max")&&(e.max=e.end))}))}}))}function To(e,t){return e&&e.hasOwnProperty&&e.hasOwnProperty(t)}var Vo=!1;function Co(e){Vo||(Vo=!0,e.registerSubTypeDefaulter("visualMap",(function(e){return e.categories||(e.pieces?e.pieces.length>0:e.splitNumber>0)&&!e.calculable?"piecewise":"continuous"})),e.registerAction(_o,So),a(Mo,(function(t){e.registerVisual(e.PRIORITY.VISUAL.COMPONENT,t)})),e.registerPreprocessor(xo))}function Do(e){e.registerComponentModel(no),e.registerComponentView(go),Co(e)}var Io=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o._pieceList=[],o}return _(t,e),t.prototype.optionUpdated=function(t,o){e.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var i=this._mode=this._determineMode();this._pieceList=[],Lo[this._mode].call(this,this._pieceList),this._resetSelected(t,o);var n=this.option.categories;this.resetVisual((function(e,t){"categories"===i?(e.mappingMethod="category",e.categories=$(n)):(e.dataExtent=this.getExtent(),e.mappingMethod="piecewise",e.pieceList=I(this._pieceList,(function(e){return e=$(e),"inRange"!==t&&(e.visual=null),e})))}))},t.prototype.completeVisualOption=function(){var t=this.option,o={},i=Vt.listVisualTypes(),n=this.isCategory();function r(e,t,o){return e&&e[t]&&e[t].hasOwnProperty(o)}a(t.pieces,(function(e){a(i,(function(t){e.hasOwnProperty(t)&&(o[t]=1)}))})),a(o,(function(e,o){var i=!1;a(this.stateList,(function(e){i=i||r(t,e,o)||r(t.target,e,o)}),this),!i&&a(this.stateList,(function(e){(t[e]||(t[e]={}))[o]=Jt(o,"inRange"===e?"active":"inactive",n)}))}),this),e.prototype.completeVisualOption.apply(this,arguments)},t.prototype._resetSelected=function(e,t){var o=this.option,i=this._pieceList,n=(t?o:e).selected||{};if(o.selected=n,a(i,(function(e,t){var o=this.getSelectedMapKey(e);n.hasOwnProperty(o)||(n[o]=!0)}),this),"single"===o.selectedMode){var r=!1;a(i,(function(e,t){var o=this.getSelectedMapKey(e);n[o]&&(r?n[o]=!1:r=!0)}),this)}},t.prototype.getItemSymbol=function(){return this.get("itemSymbol")},t.prototype.getSelectedMapKey=function(e){return"categories"===this._mode?e.value+"":e.index+""},t.prototype.getPieceList=function(){return this._pieceList},t.prototype._determineMode=function(){var e=this.option;return e.pieces&&e.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},t.prototype.setSelected=function(e){this.option.selected=$(e)},t.prototype.getValueState=function(e){var t=Vt.findPieceIndex(e,this._pieceList);return null!=t&&this.option.selected[this.getSelectedMapKey(this._pieceList[t])]?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var t=[],o=this._pieceList;return this.eachTargetSeries((function(i){var n=[],a=i.getData();a.each(this.getDataDimension(a),(function(t,i){Vt.findPieceIndex(t,o)===e&&n.push(i)}),this),t.push({seriesId:i.id,dataIndex:n})}),this),t},t.prototype.getRepresentValue=function(e){var t;if(this.isCategory())t=e.value;else if(null!=e.value)t=e.value;else{var o=e.interval||[];t=o[0]===-1/0&&o[1]===1/0?0:(o[0]+o[1])/2}return t},t.prototype.getVisualMeta=function(e){if(!this.isCategory()){var t=[],o=["",""],i=this,n=this._pieceList.slice();if(n.length){var r=n[0].interval[0];r!==-1/0&&n.unshift({interval:[-1/0,r]}),(r=n[n.length-1].interval[1])!==1/0&&n.push({interval:[r,1/0]})}else n.push({interval:[-1/0,1/0]});var s=-1/0;return a(n,(function(e){var t=e.interval;t&&(t[0]>s&&l([s,t[0]],"outOfRange"),l(t.slice()),s=t[1])}),this),{stops:t,outerColors:o}}function l(n,a){var r=i.getRepresentValue({interval:n});a||(a=i.getValueState(r));var s=e(r,a);n[0]===-1/0?o[0]=s:n[1]===1/0?o[1]=s:t.push({value:n[0],color:s},{value:n[1],color:s})}},t.type="visualMap.piecewise",t.defaultOption=be(oo.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),t}(oo),Lo={splitNumber:function(e){var t=this.option,o=Math.min(t.precision,20),i=this.getExtent(),n=t.splitNumber;n=Math.max(parseInt(n,10),1),t.splitNumber=n;for(var r=(i[1]-i[0])/n;+r.toFixed(o)!==r&&o<5;)o++;t.precision=o,r=+r.toFixed(o),t.minOpen&&e.push({interval:[-1/0,i[0]],close:[0,0]});for(var s=0,l=i[0];s<n;l+=r,s++){var p=s===n-1?i[1]:l+r;e.push({interval:[l,p],close:[1,1]})}t.maxOpen&&e.push({interval:[i[1],1/0],close:[0,0]}),Ne(e),a(e,(function(e,t){e.index=t,e.text=this.formatValueText(e.interval)}),this)},categories:function(e){var t=this.option;a(t.categories,(function(t){e.push({text:this.formatValueText(t,!0),value:t})}),this),Ro(t,e)},pieces:function(e){var t=this.option;a(t.pieces,(function(t,o){oe(t)||(t={value:t});var i={text:"",index:o};if(null!=t.label&&(i.text=t.label),t.hasOwnProperty("value")){var n=i.value=t.value;i.interval=[n,n],i.close=[1,1]}else{for(var a=i.interval=[],r=i.close=[0,0],s=[1,0,1],l=[-1/0,1/0],p=[],u=0;u<2;u++){for(var c=[["gte","gt","min"],["lte","lt","max"]][u],h=0;h<3&&null==a[u];h++)a[u]=t[c[h]],r[u]=s[h],p[u]=2===h;null==a[u]&&(a[u]=l[u])}p[0]&&a[1]===1/0&&(r[0]=0),p[1]&&a[0]===-1/0&&(r[1]=0),a[0]===a[1]&&r[0]&&r[1]&&(i.value=a[0])}i.visual=Vt.retrieveVisuals(t),e.push(i)}),this),Ro(t,e),Ne(e),a(e,(function(e){var t=e.close,o=[["<","≤"][t[1]],[">","≥"][t[0]]];e.text=e.text||this.formatValueText(null!=e.value?e.value:e.interval,!1,o)}),this)}};function Ro(e,t){var o=e.inverse;("vertical"===e.orient?!o:o)&&t.reverse()}var zo=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.type=t.type,o}return _(t,e),t.prototype.doRender=function(){var e=this.group;e.removeAll();var t=this.visualMapModel,i=t.get("textGap"),n=t.textStyleModel,r=n.getFont(),s=n.getTextColor(),l=this._getItemAlign(),p=t.itemSize,u=this._getViewData(),c=u.endsText,h=B(t.get("showLabel",!0),!c);c&&this._renderEndsText(e,c[0],p,h,l),a(u.viewPieceList,(function(n){var a=n.piece,u=new o;u.onclick=ee(this._onItemClick,this,a),this._enableHoverLink(u,n.indexInModelPieceList);var c=t.getRepresentValue(a);if(this._createItemSymbol(u,c,[0,0,p[0],p[1]]),h){var d=this.visualMapModel.getValueState(c);u.add(new Ve({style:{x:"right"===l?-i:p[0]+i,y:p[1]/2,text:a.text,verticalAlign:"middle",align:l,font:r,fill:s,opacity:"outOfRange"===d?.5:1}}))}e.add(u)}),this),c&&this._renderEndsText(e,c[1],p,h,l),Pe(t.get("orient"),e,t.get("itemGap")),this.renderBackground(e),this.positionGroup(e)},t.prototype._enableHoverLink=function(e,t){var o=this;e.on("mouseover",(function(){return i("highlight")})).on("mouseout",(function(){return i("downplay")}));var i=function(e){var i=o.visualMapModel;i.option.hoverLink&&o.api.dispatchAction({type:e,batch:po(i.findTargetDataIndices(t),i)})}},t.prototype._getItemAlign=function(){var e=this.visualMapModel,t=e.option;if("vertical"===t.orient)return lo(e,this.api,e.itemSize);var o=t.align;return o&&"auto"!==o||(o="left"),o},t.prototype._renderEndsText=function(e,t,i,n,a){if(t){var r=new o,s=this.visualMapModel.textStyleModel;r.add(new Ve({style:{x:n?"right"===a?i[0]:0:i[0]/2,y:i[1]/2,verticalAlign:"middle",align:n?a:"center",text:t,font:s.getFont(),fill:s.getTextColor()}})),e.add(r)}},t.prototype._getViewData=function(){var e=this.visualMapModel,t=I(e.getPieceList(),(function(e,t){return{piece:e,indexInModelPieceList:t}})),o=e.get("text"),i=e.get("orient"),n=e.get("inverse");return("horizontal"===i?n:!n)?t.reverse():o&&(o=o.slice().reverse()),{viewPieceList:t,endsText:o}},t.prototype._createItemSymbol=function(e,t,o){e.add(C(this.getControllerVisual(t,"symbol"),o[0],o[1],o[2],o[3],this.getControllerVisual(t,"color")))},t.prototype._onItemClick=function(e){var t=this.visualMapModel,o=t.option,i=$(o.selected),n=t.getSelectedMapKey(e);"single"===o.selectedMode?(i[n]=!0,a(i,(function(e,t){i[t]=t===n}))):i[n]=!i[n],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:i})},t.type="visualMap.piecewise",t}(ro);function Oo(e){e.registerComponentModel(Io),e.registerComponentView(zo),Co(e)}function Go(e){U(Do),U(Oo)}export{ht as V,Je as a,St as b,Vt as c,Zt as d,jt as e,Ft as f,bt as g,Go as h,wt as i,Do as j,Oo as k,Wt as r,je as u};
