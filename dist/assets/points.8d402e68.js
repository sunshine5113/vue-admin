import{_ as t,b as e,aB as a,aC as i,k as s,ax as o,ab as l,A as r,h as n,aD as c,Z as u,a as m,aa as h,aA as p,d as y,v as d,G as f,aX as g,bh as v,m as S,bW as b}from"./install.f743767a.js";import{g as I}from"./labelHelper.1919236e.js";var _=function(f){function g(t,e,a,i){var s=f.call(this)||this;return s.updateData(t,e,a,i),s}return t(g,f),g.prototype._createSymbol=function(t,a,i,s,o){this.removeAll();var l=e(t,-1,-1,2,2,null,o);l.attr({z2:100,culling:!0,scaleX:s[0]/2,scaleY:s[1]/2}),l.drift=A,this._symbolType=t,this.add(l)},g.prototype.stopSymbolAnimation=function(t){this.childAt(0).stopAnimation(null,t)},g.prototype.getSymbolPath=function(){return this.childAt(0)},g.prototype.highlight=function(){a(this.childAt(0))},g.prototype.downplay=function(){i(this.childAt(0))},g.prototype.setZ=function(t,e){var a=this.childAt(0);a.zlevel=t,a.z=e},g.prototype.setDraggable=function(t){var e=this.childAt(0);e.draggable=t,e.cursor=t?"move":e.cursor},g.prototype.updateData=function(t,e,a,i){this.silent=!1;var l=t.getItemVisual(e,"symbol")||"circle",r=t.hostModel,n=g.getSymbolSize(t,e),c=l!==this._symbolType,u=i&&i.disableAnimation;if(c){var m=t.getItemVisual(e,"symbolKeepAspect");this._createSymbol(l,t,e,n,m)}else{(p=this.childAt(0)).silent=!1;var h={scaleX:n[0]/2,scaleY:n[1]/2};u?p.attr(h):s(p,h,r,e)}if(this._updateCommon(t,e,n,a,i),c){var p=this.childAt(0);if(!u){h={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:p.style.opacity}};p.scaleX=p.scaleY=0,p.style.opacity=0,o(p,h,r,e)}}u&&this.childAt(0).stopAnimation("remove"),this._seriesModel=r},g.prototype._updateCommon=function(t,e,a,i,s){var o,y,d,f,g,v,S,b,_=this.childAt(0),A=t.hostModel;if(i&&(o=i.emphasisItemStyle,y=i.blurItemStyle,d=i.selectItemStyle,f=i.focus,g=i.blurScope,v=i.labelStatesModels,S=i.hoverScale,b=i.cursorStyle),!i||t.hasItemOption){var x=i&&i.itemModel?i.itemModel:t.getItemModel(e),M=x.getModel("emphasis");o=M.getModel("itemStyle").getItemStyle(),d=x.getModel(["select","itemStyle"]).getItemStyle(),y=x.getModel(["blur","itemStyle"]).getItemStyle(),f=M.get("focus"),g=M.get("blurScope"),v=l(x),S=M.getShallow("scale"),b=x.getShallow("cursor")}var z=t.getItemVisual(e,"symbolRotate");_.attr("rotation",(z||0)*Math.PI/180||0);var D=t.getItemVisual(e,"symbolOffset")||0;D&&(r(D)||(D=[D,D]),_.x=n(D[0],a[0]),_.y=n(c(D[1],D[0])||0,a[1])),b&&_.attr("cursor",b);var C=t.getItemVisual(e,"style"),P=C.fill;if(_ instanceof u){var w=_.style;_.useStyle(m({image:w.image,x:w.x,y:w.y,width:w.width,height:w.height},C))}else _.__isEmptyBrush?_.useStyle(m({},C)):_.useStyle(C),_.style.decal=null,_.setColor(P,s&&s.symbolInnerColor),_.style.strokeNoScale=!0;var X=t.getItemVisual(e,"liftZ"),Y=this._z2;null!=X?null==Y&&(this._z2=_.z2,_.z2+=X):null!=Y&&(_.z2=Y,this._z2=null);var G=s&&s.useNameLabel;h(_,v,{labelFetcher:A,labelDataIndex:e,defaultText:function(e){return G?t.getName(e):I(t,e)},inheritColor:P,defaultOpacity:C.opacity}),this._sizeX=a[0]/2,this._sizeY=a[1]/2;var T=_.ensureState("emphasis");if(T.style=o,_.ensureState("select").style=d,_.ensureState("blur").style=y,S){var E=Math.max(1.1,3/this._sizeY);T.scaleX=this._sizeX*E,T.scaleY=this._sizeY*E}this.setSymbolScale(1),p(this,f,g)},g.prototype.setSymbolScale=function(t){this.scaleX=this.scaleY=t},g.prototype.fadeOut=function(t,e){var a=this.childAt(0),i=this._seriesModel,s=y(this).dataIndex,o=e&&e.animation;if(this.silent=a.silent=!0,e&&e.fadeLabel){var l=a.getTextContent();l&&d(l,{style:{opacity:0}},i,{dataIndex:s,removeOpt:o,cb:function(){a.removeTextContent()}})}else a.removeTextContent();d(a,{style:{opacity:0},scaleX:0,scaleY:0},i,{dataIndex:s,cb:t,removeOpt:o})},g.getSymbolSize=function(t,e){var a=t.getItemVisual(e,"symbolSize");return r(a)?a.slice():[+a,+a]},g}(f);function A(t,e){this.parent.drift(t,e)}function x(t,e,a,i){return e&&!isNaN(e[0])&&!isNaN(e[1])&&!(i.isIgnore&&i.isIgnore(a))&&!(i.clipShape&&!i.clipShape.contain(e[0],e[1]))&&"none"!==t.getItemVisual(a,"symbol")}function M(t){return null==t||g(t)||(t={isIgnore:t}),t||{}}function z(t){var e=t.hostModel,a=e.getModel("emphasis");return{emphasisItemStyle:a.getModel("itemStyle").getItemStyle(),blurItemStyle:e.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:e.getModel(["select","itemStyle"]).getItemStyle(),focus:a.get("focus"),blurScope:a.get("blurScope"),hoverScale:a.get("scale"),labelStatesModels:l(e),cursorStyle:e.get("cursor")}}var D=function(){function t(t){this.group=new f,this._SymbolCtor=t||_}return t.prototype.updateData=function(t,e){e=M(e);var a=this.group,i=t.hostModel,o=this._data,l=this._SymbolCtor,r=e.disableAnimation,n=z(t),c={disableAnimation:r},u=e.getSymbolPoint||function(e){return t.getItemLayout(e)};o||a.removeAll(),t.diff(o).add((function(i){var s=u(i);if(x(t,s,i,e)){var o=new l(t,i,n,c);o.setPosition(s),t.setItemGraphicEl(i,o),a.add(o)}})).update((function(m,h){var p=o.getItemGraphicEl(h),y=u(m);if(x(t,y,m,e)){if(p){p.updateData(t,m,n,c);var d={x:y[0],y:y[1]};r?p.attr(d):s(p,d,i)}else(p=new l(t,m)).setPosition(y);a.add(p),t.setItemGraphicEl(m,p)}else a.remove(p)})).remove((function(t){var e=o.getItemGraphicEl(t);e&&e.fadeOut((function(){a.remove(e)}))})).execute(),this._getSymbolPoint=u,this._data=t},t.prototype.isPersistent=function(){return!0},t.prototype.updateLayout=function(){var t=this,e=this._data;e&&e.eachItemGraphicEl((function(e,a){var i=t._getSymbolPoint(a);e.setPosition(i),e.markRedraw()}))},t.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=z(t),this._data=null,this.group.removeAll()},t.prototype.incrementalUpdate=function(t,e,a){function i(t){t.isGroup||(t.incremental=!0,t.ensureState("emphasis").hoverLayer=!0)}a=M(a);for(var s=t.start;s<t.end;s++){var o=e.getItemLayout(s);if(x(e,o,s,a)){var l=new this._SymbolCtor(e,s,this._seriesScope);l.traverse(i),l.setPosition(o),this.group.add(l),e.setItemGraphicEl(s,l)}}},t.prototype.remove=function(t){var e=this.group,a=this._data;a&&t?a.eachItemGraphicEl((function(t){t.fadeOut((function(){e.remove(t)}))})):e.removeAll()},t}(),C="undefined"!=typeof Float32Array,P=C?Float32Array:Array;function w(t){return r(t)?C?new Float32Array(t):t:new P(t)}function X(t,e){return{seriesType:t,plan:v(),reset:function(t){var a=t.getData(),i=t.coordinateSystem,s=t.pipelineContext,o=e||s.large;if(i){var l=S(i.dimensions,(function(t){return a.mapDimension(t)})).slice(0,2),r=l.length,n=a.getCalculationInfo("stackResultDimension");b(a,l[0])&&(l[0]=n),b(a,l[1])&&(l[1]=n);var c=a.getDimensionInfo(l[0]),u=a.getDimensionInfo(l[1]),m=c&&c.index,h=u&&u.index;return r&&{progress:function(t,e){for(var a=t.end-t.start,s=o&&w(a*r),l=[],n=[],c=t.start,u=0;c<t.end;c++){var p=void 0;if(1===r){var y=e.getByDimIdx(m,c);p=i.dataToPoint(y,null,n)}else l[0]=e.getByDimIdx(m,c),l[1]=e.getByDimIdx(h,c),p=i.dataToPoint(l,null,n);o?(s[u++]=p[0],s[u++]=p[1]):e.setItemLayout(c,p.slice())}o&&e.setLayout("points",s)}}}}}}export{D as S,_ as a,w as c,X as p};
