import{f as e,A as t,h as a,av as n,e as i,aQ as l,cM as r,cN as s,cO as o,cc as g,_ as c,Y as u,a as h,ax as p,k as d,q as f,cP as m,aA as v,aa as y,ab as b,aP as x,aR as A,am as L,aS as M,aO as S,G as w,aT as D,C as T,a2 as N,x as I,aU as P,cQ as O,aJ as C,S as G,cR as _}from"./install.f743767a.js";import{L as E,d as R}from"./LegendVisualProvider.84b89ceb.js";import{c as k}from"./createListSimply.02618497.js";var U=2*Math.PI,V=Math.PI/180;function z(i,l,r){l.eachSeriesByType(i,(function(i){var l=i.getData(),s=l.mapDimension("value"),o=function(t,a){return e(t.getBoxLayoutParams(),{width:a.getWidth(),height:a.getHeight()})}(i,r),g=i.get("center"),c=i.get("radius");t(c)||(c=[0,c]),t(g)||(g=[g,g]);var u=a(o.width,r.getWidth()),h=a(o.height,r.getHeight()),p=Math.min(u,h),d=a(g[0],u)+o.x,f=a(g[1],h)+o.y,m=a(c[0],p/2),v=a(c[1],p/2),y=-i.get("startAngle")*V,b=i.get("minAngle")*V,x=0;l.each(s,(function(e){!isNaN(e)&&x++}));var A=l.getSum(s),L=Math.PI/(A||x)*2,M=i.get("clockwise"),S=i.get("roseType"),w=i.get("stillShowZeroSum"),D=l.getDataExtent(s);D[0]=0;var T=U,N=0,I=y,P=M?1:-1;if(l.setLayout({viewRect:o,r:v}),l.each(s,(function(e,t){var a;if(isNaN(e))l.setItemLayout(t,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:M,cx:d,cy:f,r0:m,r:S?NaN:v});else{(a="area"!==S?0===A&&w?L:e*L:U/x)<b?(a=b,T-=b):N+=e;var i=I+P*a;l.setItemLayout(t,{angle:a,startAngle:I,endAngle:i,clockwise:M,cx:d,cy:f,r0:m,r:S?n(e,D,[m,v]):v}),I=i}})),T<U&&x)if(T<=.001){var O=U/x;l.each(s,(function(e,t){if(!isNaN(e)){var a=l.getItemLayout(t);a.angle=O,a.startAngle=y+P*t*O,a.endAngle=y+P*(t+1)*O}}))}else L=T/N,I=y,l.each(s,(function(e,t){if(!isNaN(e)){var a=l.getItemLayout(t),n=a.angle===b?b:e*L;a.startAngle=I,a.endAngle=I+P*n,I+=P*n}}))}))}var B=Math.PI/180;function Y(e,t,a,n,i,l,r,s,g,c){if(!(e.length<2)){for(var u=e.length,h=0;h<u;h++)if("outer"===e[h].position&&"labelLine"===e[h].labelAlignTo){var p=e[h].label.x-c;e[h].linePoints[1][0]+=p,e[h].label.x=c}o(e,g,g+r)&&function(e){for(var l={list:[],maxY:0},r={list:[],maxY:0},s=0;s<e.length;s++)if("none"===e[s].labelAlignTo){var o=e[s],g=o.label.y>a?r:l,c=Math.abs(o.label.y-a);if(c>g.maxY){var u=o.label.x-t-o.len2*i,h=n+o.len,p=Math.abs(u)<h?Math.sqrt(c*c/(1-u*u/h/h)):h;g.rB=p,g.maxY=c}g.list.push(o)}d(l),d(r)}(e)}function d(e){for(var l=e.rB,r=l*l,s=0;s<e.list.length;s++){var o=e.list[s],g=Math.abs(o.label.y-a),c=n+o.len,u=c*c,h=Math.sqrt((1-Math.abs(g*g/r))*u);o.label.x=t+(h+o.len2)*i}}}function q(e){return"center"===e.position}function j(e){var t,n,o=e.getData(),g=[],c=!1,u=(e.get("minShowLabelAngle")||0)*B,h=o.getLayout("viewRect"),p=o.getLayout("r"),d=h.width,f=h.x,m=h.y,v=h.height;function y(e){e.ignore=!0}o.each((function(e){var r=o.getItemGraphicEl(e),s=r.shape,h=r.getTextContent(),m=r.getTextGuideLine(),v=o.getItemModel(e),b=v.getModel("label"),x=b.get("position")||v.get(["emphasis","label","position"]),A=b.get("distanceToLabelLine"),L=b.get("alignTo"),M=a(b.get("edgeDistance"),d),S=b.get("bleedMargin"),w=v.getModel("labelLine"),D=w.get("length");D=a(D,d);var T=w.get("length2");if(T=a(T,d),Math.abs(s.endAngle-s.startAngle)<u)return i(h.states,y),void(h.ignore=!0);if(function(e){if(!e.ignore)return!0;for(var t in e.states)if(!1===e.states[t].ignore)return!0;return!1}(h)){var N,I,P,O,C=(s.startAngle+s.endAngle)/2,G=Math.cos(C),_=Math.sin(C);t=s.cx,n=s.cy;var E,R="inside"===x||"inner"===x;if("center"===x)N=s.cx,I=s.cy,O="center";else{var k=(R?(s.r+s.r0)/2*G:s.r*G)+t,U=(R?(s.r+s.r0)/2*_:s.r*_)+n;if(N=k+3*G,I=U+3*_,!R){var V=k+G*(D+p-s.r),z=U+_*(D+p-s.r),B=V+(G<0?-1:1)*T;N="edge"===L?G<0?f+M:f+d-M:B+(G<0?-A:A),I=z,P=[[k,U],[V,z],[B,z]]}O=R?"center":"edge"===L?G>0?"right":"left":G>0?"left":"right"}var Y=b.get("rotate");if(E="number"==typeof Y?Y*(Math.PI/180):Y?G<0?-C+Math.PI:-C:0,c=!!E,h.x=N,h.y=I,h.rotation=E,h.setStyle({verticalAlign:"middle"}),R){h.setStyle({align:O});var q=h.states.select;q&&(q.x+=h.x,q.y+=h.y)}else{var j=h.getBoundingRect().clone();j.applyTransform(h.getComputedTransform());var H=(h.style.margin||0)+2.1;j.y-=H/2,j.height+=H,g.push({label:h,labelLine:m,position:x,len:D,len2:T,minTurnAngle:w.get("minTurnAngle"),maxSurfaceAngle:w.get("maxSurfaceAngle"),surfaceNormal:new l(G,_),linePoints:P,textAlign:O,labelDistance:A,labelAlignTo:L,edgeDistance:M,bleedMargin:S,rect:j})}r.setTextConfig({inside:R})}})),!c&&e.get("avoidLabelOverlap")&&function(e,t,a,n,i,l,r,s){for(var o=[],g=[],c=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=0;h<e.length;h++){var p=e[h].label;q(e[h])||(p.x<t?(c=Math.min(c,p.x),o.push(e[h])):(u=Math.max(u,p.x),g.push(e[h])))}for(Y(g,t,a,n,1,0,l,0,s,u),Y(o,t,a,n,-1,0,l,0,s,c),h=0;h<e.length;h++){var d=e[h];if(p=d.label,!q(d)){var f=d.linePoints;if(f){var m="edge"===d.labelAlignTo,v=d.rect.width,y=void 0;(y=m?p.x<t?f[2][0]-d.labelDistance-r-d.edgeDistance:r+i-d.edgeDistance-f[2][0]-d.labelDistance:p.x<t?p.x-r-d.bleedMargin:r+i-p.x-d.bleedMargin)<d.rect.width&&(d.label.style.width=y,"edge"===d.labelAlignTo&&(v=y));var b=f[1][0]-f[2][0];m?p.x<t?f[2][0]=r+d.edgeDistance+v+d.labelDistance:f[2][0]=r+i-d.edgeDistance-v-d.labelDistance:(p.x<t?f[2][0]=p.x+d.labelDistance:f[2][0]=p.x-d.labelDistance,f[1][0]=f[2][0]+b),f[1][1]=f[2][1]=p.y}}}}(g,t,n,p,d,v,f,m);for(var b=0;b<g.length;b++){var x=g[b],A=x.label,L=x.labelLine,M=isNaN(A.x)||isNaN(A.y);if(A){A.setStyle({align:x.textAlign}),M&&(i(A.states,y),A.ignore=!0);var S=A.states.select;S&&(S.x+=A.x,S.y+=A.y)}if(L){var w=x.linePoints;M||!w?(i(L.states,y),L.ignore=!0):(r(w,x.minTurnAngle),s(w,x.surfaceNormal,x.maxSurfaceAngle),L.setShape({points:w}),A.__hostTarget.textGuideLineConfig={anchor:new l(w[0][0],w[0][1])})}}}function H(e,a){var n=e.get("borderRadius");return null==n?null:(t(n)||(n=[n,n]),{innerCornerRadius:g(n[0],a.r0),cornerRadius:g(n[1],a.r)})}var W=function(e){function t(t,a,n){var i=e.call(this)||this;i.z2=2;var l=new u;return i.setTextContent(l),i.updateData(t,a,n,!0),i}return c(t,e),t.prototype.updateData=function(e,t,a,n){var i=this,l=e.hostModel,r=e.getItemModel(t),s=r.getModel("emphasis"),o=e.getItemLayout(t),g=h(H(r.getModel("itemStyle"),o)||{},o);if(isNaN(g.startAngle))i.setShape(g);else{if(n)i.setShape(g),"scale"===l.getShallow("animationType")?(i.shape.r=o.r0,p(i,{shape:{r:o.r}},l,t)):null!=a?(i.setShape({startAngle:a,endAngle:a}),p(i,{shape:{startAngle:o.startAngle,endAngle:o.endAngle}},l,t)):(i.shape.endAngle=o.startAngle,d(i,{shape:{endAngle:o.endAngle}},l,t));else d(i,{shape:g},l,t);i.useStyle(e.getItemVisual(t,"style")),f(i,r);var c=(o.startAngle+o.endAngle)/2,u=l.get("selectedOffset"),y=Math.cos(c)*u,b=Math.sin(c)*u,x=r.getShallow("cursor");x&&i.attr("cursor",x),this._updateLabel(l,e,t),i.ensureState("emphasis").shape=m({r:o.r+(s.get("scale")&&s.get("scaleSize")||0)},H(s.getModel("itemStyle"),o)),h(i.ensureState("select"),{x:y,y:b,shape:H(r.getModel(["select","itemStyle"]),o)}),h(i.ensureState("blur"),{shape:H(r.getModel(["blur","itemStyle"]),o)});var A=i.getTextGuideLine(),L=i.getTextContent();A&&h(A.ensureState("select"),{x:y,y:b}),h(L.ensureState("select"),{x:y,y:b}),v(this,s.get("focus"),s.get("blurScope"))}},t.prototype._updateLabel=function(e,t,a){var n=this,i=t.getItemModel(a),l=i.getModel("labelLine"),r=t.getItemVisual(a,"style"),s=r&&r.fill,o=r&&r.opacity;y(n,b(i),{labelFetcher:t.hostModel,labelDataIndex:a,inheritColor:s,defaultOpacity:o,defaultText:e.getFormattedLabel(a,"normal")||t.getName(a)});var g=n.getTextContent();n.setTextConfig({position:null,rotation:null}),g.attr({z2:10});var c=e.get(["label","position"]);if("outside"!==c&&"outer"!==c)n.removeTextGuideLine();else{var u=this.getTextGuideLine();u||(u=new x,this.setTextGuideLine(u)),A(this,M(i),{stroke:s,opacity:L(l.get(["lineStyle","opacity"]),o,1)})}},t}(S),F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ignoreLabelLineUpdate=!0,t}return c(t,e),t.prototype.init=function(){var e=new w;this._sectorGroup=e},t.prototype.render=function(e,t,a,n){var i,l=e.getData(),r=this._data,s=this.group;if(!r&&l.count()>0){for(var o=l.getItemLayout(0),g=1;isNaN(o&&o.startAngle)&&g<l.count();++g)o=l.getItemLayout(g);o&&(i=o.startAngle)}l.diff(r).add((function(e){var t=new W(l,e,i);l.setItemGraphicEl(e,t),s.add(t)})).update((function(e,t){var a=r.getItemGraphicEl(t);a.updateData(l,e,i),a.off("click"),s.add(a),l.setItemGraphicEl(e,a)})).remove((function(t){var a=r.getItemGraphicEl(t);D(a,e,t)})).execute(),j(e),"expansion"!==e.get("animationTypeUpdate")&&(this._data=l)},t.prototype.dispose=function(){},t.prototype.containPoint=function(e,t){var a=t.getData().getItemLayout(0);if(a){var n=e[0]-a.cx,i=e[1]-a.cy,l=Math.sqrt(n*n+i*i);return l<=a.r&&l>=a.r0}},t.type="pie",t}(T),Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.useColorPaletteOnData=!0,t}return c(t,e),t.prototype.init=function(t){e.prototype.init.apply(this,arguments),this.legendVisualProvider=new E(N(this.getData,this),N(this.getRawData,this)),this._defaultLabelLine(t)},t.prototype.mergeOption=function(){e.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return k(this,{coordDimensions:["value"],encodeDefaulter:I(P,this)})},t.prototype.getDataParams=function(t){var a=this.getData(),n=e.prototype.getDataParams.call(this,t),i=[];return a.each(a.mapDimension("value"),(function(e){i.push(e)})),n.percent=O(i,t,a.hostModel.get("percentPrecision")),n.$vars.push("percent"),n},t.prototype._defaultLabelLine=function(e){C(e,"labelLine",["show"]);var t=e.labelLine,a=e.emphasis.labelLine;t.show=t.show&&e.label.show,a.show=a.show&&e.emphasis.label.show},t.type="series.pie",t.defaultOption={zlevel:0,z:2,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(G);function X(e){e.registerChartView(F),e.registerSeriesModel(Q),_("pie",e.registerAction),e.registerLayout(I(z,"pie")),e.registerProcessor(R("pie"))}export{H as g,X as i};
